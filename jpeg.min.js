function JPEG(){"use strict";if(void 0===new.target)throw new Error("Constructor must be called with new.");let e,t;const r=[];let s=0;const n=(e,t)=>{s++;const r=new Image;r.onload=(()=>{a(r,t)}),r.onerror=(()=>{s--,o(new Error("Image Load Failed."),t)}),r.src=URL.createObjectURL(e)},a=(e,t)=>{const r=document.createElement("canvas"),n=r.getContext("2d"),a=e.naturalWidth,o=e.naturalHeight;function l(r){s--,URL.revokeObjectURL(e.src),e.remove(),"string"==typeof r&&(r=new Blob(r.split(",")[1],"image/jpeg")),t.success&&t.success(r)}r.width=a,r.height=o,n.fillStyle="white",n.fillRect(0,0,a,o),n.save(),n.translate(a/2,o/2),n.drawImage(e,-a/2,-o/2,a,o),n.restore(),r.toBlob?r.toBlob(l,"image/jpeg"):l(r.toDataURL("image/jpeg")),r.remove()},o=(e,t,s)=>{if(null!=s&&null!=s&&delete r[s],!t.error)throw e;t.error(e)},l=e=>{const t=e.data,s=r[t.return];if(s)switch(t.type){case"success":s.success&&(s.success(t.result),delete r[t.return]);break;case"error":o(t.result,s,t.return)}},c=()=>{self.addEventListener("message",t=>{const r=t.data;e(r)});const e=e=>{createImageBitmap(e.file).then(t(e)).catch(t=>{self.postMessage({type:"error",result:t,return:e.return})})},t=e=>t=>{const r=new OffscreenCanvas(t.width,t.height),s=r.getContext("2d"),n=t.width,a=t.height;s.fillStyle="white",s.fillRect(0,0,n,a),s.save(),s.translate(n/2,a/2),s.drawImage(t,-n/2,-a/2,n,a),s.restore(),r.convertToBlob({type:"image/jpeg"}).then(t=>{self.postMessage({type:"success",result:t,return:e.return})})}};return createImageBitmap&&Worker&&OffscreenCanvas&&(t=URL.createObjectURL(new Blob([`(${c.toString()})()`])),(e=new Worker(t)).addEventListener("message",l)),new class{start(t,a){if(void 0!==t&&void 0!==a||o(new Error("Please Input File And Options"),a),!t instanceof File&&!t instanceof Blob&&o(new Error("file type must Blob or File only."),a),s>100&&(!e||Object.keys(r).length>100)){const o=setInterval(()=>{if(s<=100||!e&&Object.keys(r).length<=100){if(!e||s<=Object.keys(r).length)n(t,a);else{const s=r.length;r[s]=a,e.postMessage({file:t,return:s})}clearInterval(o)}},1e3)}else if(!e||s<=Object.keys(r).length)n(t,a);else{const s=r.length;r[s]=a,e.postMessage({file:t,return:s})}}}}